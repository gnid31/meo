<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hihi concho H·∫±ng</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #FFC0CB;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 40px 20px;
      box-sizing: border-box;
      overflow: hidden;
      transition: background-image 0.5s ease-out;
    }

    .container {
      background-color: rgba(255, 255, 255, 0.7);
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      text-align: center;
      max-width: 500px;
      width: 100%;
      position: relative;
      z-index: 10;
    }

    h1 {
      color: #FF69B4;
      margin-bottom: 25px;
      font-size: 2.5em;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      animation: wave 2s ease-in-out infinite alternate;
    }

    audio {
      display: none;
    }

    p {
      font-size: 1.2em;
      line-height: 1.7;
      color: #FF1493;
      margin-top: 20px;
      font-style: italic;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    .snowflake {
      color: #fff;
      font-size: 1.2em;
      position: fixed;
      top: -10px;
      opacity: 0.7;
      user-select: none;
      pointer-events: none;
    }

    #splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #FFC0CB;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
      text-align: center;
      transition: opacity 0.5s ease-out;
    }

    #splash-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    #mystery-text {
      font-size: 3.5em;
      font-weight: bold;
      color: #FFD700;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
      margin-bottom: 30px;
      animation: bounce 1s infinite alternate;
    }

    @keyframes bounce {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(-10px);
      }
    }

    #exit-hint {
      position: absolute;
      top: 20px;
      width: 100%;
      text-align: center;
      color: #fff;
      font-size: 1.5em;
      font-weight: bold;
      text-shadow: 1px 1px 3px black;
      z-index: 100001;
      animation: gentleShake 2s infinite ease-in-out;
    }


    #gift-box {
      width: 150px;
      height: 150px;
      margin-bottom: 40px;
      position: relative;
    }

    #claim-button {
      background-color: #FF1493;
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      font-size: 2em;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease, scale 0.2s ease-in-out;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    #claim-button:hover {
      background-color: #e60073;
      transform: translateY(-2px);
      scale: 1.05;
    }

    #question-box {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      border: 3px solid #FF69B4;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      text-align: center;
      z-index: 10000;
      transform-origin: center;
    }

    #error-message {
      color: red;
      margin-top: 10px;
      font-weight: bold;
    }

    #attempts-left {
      color: red;
      margin-top: 5px;
    }

    #locked-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10001;
      color: #fff;
      font-size: 2em;
      text-align: center;
      padding: 20px;
      transition: opacity 0.3s ease-in-out;
    }

    #locked-screen .highlight-text {
      font-size: 3em;
      font-weight: bold;
      color: #FFD700;
      text-shadow: 0 0 15px #ff69b4, 0 0 25px #ff1493, 2px 2px 10px rgba(0, 0, 0, 0.7);
      animation: glowText 1.5s ease-in-out infinite alternate;
    }

    #song-buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #song-buttons button {
      background-color: #FF69B4;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      margin: 5px;
      font-size: 1em;
      cursor: pointer;
      transition: transform 0.2s ease;
      width: 120px;
    }

    #song-buttons button:hover {
      background-color: #e60073;
      transform: scale(1.05);
    }


    @keyframes glowText {
      from {
        text-shadow: 0 0 10px #ff69b4, 0 0 20px #ff1493;
        transform: scale(1);
      }

      to {
        text-shadow: 0 0 20px #ff69b4, 0 0 30px #ff1493;
        transform: scale(1.05);
      }
    }

    @keyframes gentleShake {
      0% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-2px);
      }

      50% {
        transform: translateX(2px);
      }

      75% {
        transform: translateX(-1px);
      }

      100% {
        transform: translateX(0);
      }
    }

    #locked-screen .f5-hint {
      animation: gentleShake 1s infinite ease-in-out;
      font-size: 0.8em;
      margin-top: 20px;
      color: #fff;
      opacity: 0.9;
    }

    #screensaver {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      z-index: 100000;
      display: none;
      overflow: hidden;
    }

    #screensaver img {
      position: absolute;
      width: 200px;
      height: 200px;
      object-fit: contain;
      pointer-events: none;
    }


    @media (max-width: 600px) {
      .container {
        padding: 25px 30px;
      }

      h1 {
        font-size: 2em;
      }

      p {
        font-size: 1.1em;
      }

      #mystery-text {
        font-size: 2.5em;
      }

      #gift-box {
        width: 120px;
        height: 120px;
      }

      #claim-button {
        font-size: 1.5em;
        padding: 12px 30px;
      }

      /* ƒêi·ªÅu ch·ªânh c·ª° ch·ªØ cho m√†n h√¨nh kh√≥a v√† m√†n h√¨nh th√†nh c√¥ng tr√™n mobile */
      #locked-screen .highlight-text,
      #success-exit-hint {
        font-size: 1.5em; /* Gi·∫£m c·ª° ch·ªØ tr√™n m√†n h√¨nh nh·ªè */
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translate(-50%, -50%);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: translate(calc(-50% - 5px), calc(-50% - 2px));
      }

      20%,
      40%,
      60%,
      80% {
        transform: translate(calc(-50% + 5px), calc(-50% + 2px));
      }
    }

    .shake {
      animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both;
    }

    .popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 10002;
      justify-content: center;
      align-items: center;
    }

    .popup-content {
      background-color: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 400px;
      width: 90%;
      animation: popupAppear 0.5s ease-out;
      border: 3px solid #FF69B4;
      box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
    }

    .popup-content h2 {
      color: #FF1493;
      margin-bottom: 20px;
      font-size: 2em;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }

    #close-popup {
      background-color: #FF69B4;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 1.2em;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s ease;
    }

    #close-popup:hover {
      background-color: #FF1493;
      transform: scale(1.05);
    }

    @keyframes popupAppear {
      from {
        transform: scale(0.8);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* New CSS for the GIF overlay */
    #error-gif-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgb(255, 255, 255); /* ƒê√£ thay ƒë·ªïi t·ª´ rgba(255, 255, 255, 0.9) th√†nh m√†u tr·∫Øng ho√†n to√†n */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10003; /* Above question box */
      pointer-events: none; /* Allow clicks to pass through if needed */
      opacity: 0; /* Initially hidden */
      transition: opacity 0.3s ease-in-out;
    }

    #error-gif-overlay.visible {
      opacity: 1;
    }

    #error-gif {
      width: 80%; /* Adjust size as needed */
      height: auto;
      max-width: 250px; /* Max width for larger screens */
    }

    /* New styles for submit-answer button */
    #submit-answer {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #FF69B4;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      transition: transform 0.2s ease, background-color 0.3s ease; /* Th√™m hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi m∆∞·ª£t m√† */
    }

    #submit-answer:hover:not(:disabled) {
      background-color: #e60073; /* M√†u t·ªëi h∆°n khi hover */
      transform: scale(1.05); /* Ph·ªìng ra m·ªôt ch√∫t */
    }

    #submit-answer:disabled {
      background-color: #cccccc; /* M√†u x√°m khi b·ªã v√¥ hi·ªáu h√≥a */
      cursor: not-allowed;
    }

    /* New CSS for success screensaver */
    #success-screensaver {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #FFC0CB; /* M√†u h·ªìng ph·∫•n */
      display: none; /* Hidden by default */
      overflow: hidden;
      z-index: 9999;
    }

    #success-screensaver .firework-gif {
      position: absolute;
      width: 150px; /* K√≠ch th∆∞·ªõc c∆° b·∫£n c·ªßa GIF ph√°o hoa */
      height: auto;
      opacity: 0;
      animation: fadeAndMove 4s ease-out forwards; /* Ho·∫°t ·∫£nh fade out v√† di chuy·ªÉn */
      pointer-events: none;
    }

    /* New styles for success exit hint */
    #success-exit-hint {
      position: absolute;
      top: 20px;
      width: 100%;
      text-align: center;
      color: #fff;
      font-size: 2em;
      font-weight: bold;
      text-shadow: 1px 1px 3px black;
      z-index: 100001;
      animation: gentleShake 2s infinite ease-in-out; /* √Åp d·ª•ng animation gentleShake */
    }

    @keyframes fadeAndMove {
      0% {
        opacity: 0;
        transform: translateY(0) scale(0.5);
      }
      20% {
        opacity: 1;
        transform: translateY(-20px) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-100px) scale(0.8);
      }
    }
  </style>
</head>

<body>
  <div id="splash-screen">
    <div id="mystery-text">Mystery Box</div>
    <img id="gift-box"
      src="https://raw.githubusercontent.com/gnid31/meo/refs/heads/main/gif/box.gif"
      alt="Gift Box">
    <button id="claim-button">Unbox</button>
  </div>

  <div id="question-box">
    <div><strong>C√¢u h·ªèi b√≠ m·∫≠t:</strong> Chu·ªói ƒë·ªïi m√†u l√∫c bao nhiu t·ªßi???</div>
    <input type="text" id="secret-answer" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..."
      style="padding: 10px; font-size: 1em; margin-top: 15px; width: 80%;">
    <button id="submit-answer">Tr·∫£ l·ªùi</button>
    <div id="error-message"></div>
    <div id="attempts-left"></div>
    <!-- New GIF overlay -->
    <div id="error-gif-overlay">
      <img id="error-gif" src="https://raw.githubusercontent.com/gnid31/meo/refs/heads/main/gif/bite.gif" alt="Error GIF">
    </div>
  </div>

  <div id="locked-screen">
    <div class="highlight-text">
      <div>ƒë√°ng ƒë√°nh!!!</div>
    </div>
    <!-- New GIF for locked screen -->
    <img id="fight-gif" src="https://raw.githubusercontent.com/gnid31/meo/refs/heads/main/gif/fight3.gif" alt="Fight GIF">
    <div class="f5-hint">Press F5 to continue opening the Mystery Box</div>
  </div>

  <div class="container">
    <h1>g·ª≠i t·∫∑ng concho H·∫±ng ·∫°!</h1>
    <div id="song-selector">
      <p>üéµ Meo meo ƒëi n√†y</p>
      <div id="song-buttons">
        <button onclick="playSong(0)">B√†i 8</button>
        <button onclick="playSong(1)">B√†i 20</button>
        <button onclick="playSong(2)">B√†i 7</button>
        <button onclick="playSong(3)">B√†i 0</button>
        <button onclick="playSong(4)">B√†i 13</button>
        <button onclick="playSong(5)">B√†i 6</button>
      </div>
    </div>

    <audio id="myAudio" controls>
      <source id="audio-source" src="" type="audio/mpeg">
      Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ audio.
    </audio>

    <p></p>
  </div>

  <audio id="error-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

  <!-- New success screensaver HTML -->
  <div id="success-screensaver">
    <div id="success-exit-hint">Press any key to exit</div>
  </div>

  <script>

    const BACKGROUND_IMAGE_URL = "C:/Users/ADMIN/Desktop/meomeo/wallpaper/e82e59a091fccfe88d581ef7dc56f070.jpg";
    let attemptsLeft = 4;
    let fireworkInterval = null;
    let animationInterval = null; // C·∫ßn l√† global ƒë·ªÉ showScreensaver c√≥ th·ªÉ clear n√≥

    // Khai b√°o c√°c bi·∫øn DOM element ·ªü ph·∫°m vi to√†n c·ª•c
    let screensaver;
    let bouncingImg;
    let splashScreen;
    let claimButton;
    let audio;
    let body;
    let questionBox;
    let answerInput;
    let submitBtn;
    let errorMessage;
    let attemptsMessage;
    let lockedScreen;
    let errorSound;
    let errorGifOverlay;
    let successScreensaver;

    const baseGifDuration = 1580; // Th·ªùi gian c∆° b·∫£n cho GIF (miligi√¢y)

    function createSnowflake() {
      if (document.querySelectorAll('.snowflake').length > 100) return;
      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');
      snowflake.innerHTML = '‚ùÑ';
      document.body.appendChild(snowflake);
      const startPosition = Math.random() * window.innerWidth;
      const endPosition = window.innerHeight + 20;
      const fallDuration = Math.random() * 5 + 5;
      const startScale = (Math.random() * 0.5 + 0.5) * 1.5;
      const endScale = startScale * 0.3;
      const horizontalDrift = Math.random() * 50 - 25;
      snowflake.style.left = `${startPosition}px`;
      snowflake.style.fontSize = `${startScale}em`;
      snowflake.style.opacity = Math.random() * 0.5 + 0.5;
      const animation = snowflake.animate([
        {
          transform: `translateY(0) translateX(0) scale(${startScale})`,
          opacity: snowflake.style.opacity
        },
        {
          transform: `translateY(${endPosition}px) translateX(${horizontalDrift}px) scale(${endScale})`,
          opacity: 0
        }
      ], {
        duration: fallDuration * 1000,
        easing: 'linear',
        iterations: 1
      });
      animation.onfinish = () => {
        snowflake.remove();
      };
    }

    function startSnowfall(flakeInterval = 133) {
      setInterval(createSnowflake, flakeInterval);
    }

    const songList = [
      "https://github.com/gnid31/meo/raw/main/music/id_072019.mp3",
      "https://github.com/gnid31/meo/raw/main/music/uoc_gi.mp3",
      "https://github.com/gnid31/meo/raw/main/music/hen_mot_mai.mp3",
      "https://github.com/gnid31/meo/raw/main/music/am_tham_ben_em.mp3",
      "https://github.com/gnid31/meo/raw/main/music/neu_ngay_ay.mp3",
      "https://github.com/gnid31/meo/raw/main/music/gia_nhu_em_nhin_lai.mp3",
    ];

    function playSong(index) {
      const songUrl = songList[index];
      showScreensaver(songUrl);
    }

    document.addEventListener('DOMContentLoaded', async () => {

      // G√°n c√°c bi·∫øn DOM element ·ªü ƒë√¢y
      screensaver = document.getElementById("screensaver");
      bouncingImg = document.getElementById("bouncing-image");
      splashScreen = document.getElementById('splash-screen');
      claimButton = document.getElementById('claim-button');
      audio = document.getElementById('myAudio');
      body = document.body;
      questionBox = document.getElementById('question-box');
      answerInput = document.getElementById('secret-answer');
      submitBtn = document.getElementById('submit-answer');
      errorMessage = document.getElementById('error-message');
      attemptsMessage = document.getElementById('attempts-left');
      lockedScreen = document.getElementById('locked-screen');
      errorSound = document.getElementById('error-sound');
      errorGifOverlay = document.getElementById('error-gif-overlay');
      successScreensaver = document.getElementById('success-screensaver'); // Get the new success screensaver

      function handleAnswerSubmission() {
        const correctAnswer = '107';
        if (answerInput.value.trim() === correctAnswer) {
          questionBox.style.display = 'none';
          // Hide splash screen if it's still visible
          splashScreen.classList.add('hidden');

          // Show success screensaver
          successScreensaver.style.display = 'block';
          startFireworksEffect(); // Start the fireworks effect

          setTimeout(() => {
            body.style.backgroundImage = `url(${BACKGROUND_IMAGE_URL})`;
            startSnowfall();
          }, 500);
          audio.muted = false;
          audio.play().catch(console.error); // Play main audio
        } else {
          attemptsLeft--;
          answerInput.disabled = true;
          submitBtn.disabled = true;

          questionBox.classList.add('shake');

          if (attemptsLeft > 0) {
            // Bu·ªôc GIF t·∫£i l·∫°i t·ª´ ƒë·∫ßu
            errorGifOverlay.querySelector('#error-gif').src = '';
            errorGifOverlay.querySelector('#error-gif').src = 'https://raw.githubusercontent.com/gnid31/meo/refs/heads/main/gif/bite.gif';

            errorGifOverlay.classList.add('visible'); // Hi·ªÉn th·ªã GIF

            const currentGifDuration = baseGifDuration * (4 - attemptsLeft); // T√≠nh to√°n th·ªùi gian d·ª±a tr√™n s·ªë l·∫ßn sai
            setTimeout(() => {
              errorGifOverlay.classList.remove('visible'); // ·∫®n GIF sau th·ªùi gian t√≠nh to√°n
              answerInput.disabled = false; // K√≠ch ho·∫°t l·∫°i √¥ nh·∫≠p li·ªáu
              answerInput.focus();          // T·∫≠p trung v√†o √¥ nh·∫≠p li·ªáu
            }, currentGifDuration);
          } else {
            // N·∫øu l√† l·∫ßn cu·ªëi c√πng (attemptsLeft = 0), kh√¥ng hi·ªÉn th·ªã GIF,
            // v√† c√°c n√∫t/√¥ nh·∫≠p li·ªáu s·∫Ω kh√¥ng ƒë∆∞·ª£c k√≠ch ho·∫°t l·∫°i v√¨ h·ªôp c√¢u h·ªèi s·∫Ω bi·∫øn m·∫•t.
          }

          errorSound.play()
            .then(() => {
              errorSound.onended = () => {
                questionBox.classList.remove('shake');
              };
            })
            .catch(console.error);

          if (attemptsLeft <= 0) {
            questionBox.style.display = 'none';
            lockedScreen.style.display = 'flex';
          } else {
            errorMessage.textContent = 'Sai r·ªìi, l√™u l√™u!';
            attemptsMessage.textContent = `C√≤n ${attemptsLeft} l·∫ßn nh·∫≠p th√¥i nha!`;
            answerInput.value = '';
          }
        }
      }

      if (claimButton && submitBtn && questionBox && answerInput) {
        claimButton.addEventListener('click', () => {
          questionBox.style.display = 'block';
          answerInput.focus();
          // Sau khi hi·ªán question box, ƒë·∫£m b·∫£o n√∫t tr·∫£ l·ªùi ƒë√∫ng tr·∫°ng th√°i ban ƒë·∫ßu (disabled n·∫øu r·ªóng)
          if (answerInput.value.trim() === '') {
            submitBtn.disabled = true;
          }
        });

        submitBtn.addEventListener('click', handleAnswerSubmission);

        // Th√™m s·ª± ki·ªán 'input' ƒë·ªÉ ki·ªÉm tra √¥ nh·∫≠p li·ªáu v√† k√≠ch ho·∫°t/v√¥ hi·ªáu h√≥a n√∫t
        answerInput.addEventListener('input', () => {
          if (answerInput.value.trim() === '') {
            submitBtn.disabled = true;
          } else {
            submitBtn.disabled = false;
          }
        });


        answerInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            // Ch·ªâ g·ªçi handleAnswerSubmission n·∫øu n√∫t kh√¥ng b·ªã disabled (t·ª©c l√† input kh√¥ng r·ªóng)
            if (!submitBtn.disabled) {
              handleAnswerSubmission();
            }
          }
        });


        window.addEventListener('keydown', (e) => {
          if (e.key === 'F5') {
            e.preventDefault(); // NgƒÉn trang reload

            attemptsLeft = 4;
            errorMessage.textContent = '';
            attemptsMessage.textContent = '';
            answerInput.value = ''; // X√≥a gi√° tr·ªã
            lockedScreen.style.display = 'none';
            questionBox.style.display = 'block';
            answerInput.disabled = false; // K√≠ch ho·∫°t l·∫°i √¥ nh·∫≠p li·ªáu
            answerInput.focus();
            // K√≠ch ho·∫°t l·∫°i n√∫t tr·∫£ l·ªùi s·∫Ω ƒë∆∞·ª£c x·ª≠ l√Ω t·ª± ƒë·ªông khi value c·ªßa input thay ƒë·ªïi (th√†nh r·ªóng)
            answerInput.dispatchEvent(new Event('input')); // K√≠ch ho·∫°t s·ª± ki·ªán input ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t

            // ƒê·∫£m b·∫£o d·ª´ng v√† x√≥a ph√°o hoa khi reset ho√†n to√†n
            if (fireworkInterval) {
              clearInterval(fireworkInterval);
              fireworkInterval = null;
            }
            if (successScreensaver) {
              successScreensaver.style.display = 'none';
            }

          } else if (successScreensaver && successScreensaver.style.display === 'block') { // Th√™m ƒëi·ªÅu ki·ªán tho√°t m√†n h√¨nh th√†nh c√¥ng
            // Khi ng∆∞·ªùi d√πng nh·∫•n ph√≠m b·∫•t k·ª≥ ƒë·ªÉ tho√°t m√†n h√¨nh th√†nh c√¥ng
            successScreensaver.style.display = 'none';
            if (fireworkInterval) {
              clearInterval(fireworkInterval);
              fireworkInterval = null;
            }
            // T√πy ch·ªçn: D·ª´ng nh·∫°c ho·∫∑c reset screensaver ch√≠nh ·ªü ƒë√¢y n·∫øu c·∫ßn
            if (audio) {
              audio.pause();
              audio.currentTime = 0;
            }
          }
        });


      } else {
        console.error('M·ªôt ho·∫∑c nhi·ªÅu ph·∫ßn t·ª≠ kh√¥ng ƒë∆∞·ª£c t√¨m th·∫•y trong DOM.');
      }
    });


    const bouncingImages = [];

    // H√†m ƒë·ªÉ ƒë·ªçc danh s√°ch ·∫£nh t·ª´ URL v√† t·∫£i tr∆∞·ªõc ch√∫ng
    async function loadImages() {
      try {
        console.log('B·∫Øt ƒë·∫ßu t·∫£i danh s√°ch ·∫£nh...');
        const response = await fetch('https://raw.githubusercontent.com/gnid31/meo/refs/heads/main/list.txt');
        console.log('Response status:', response.status);
        const text = await response.text();
        console.log('Text nh·∫≠n ƒë∆∞·ª£c:', text);
        const imageUrls = text.split('\n').filter(url => url.trim() !== '');
        console.log('S·ªë l∆∞·ª£ng ·∫£nh t√¨m th·∫•y:', imageUrls.length);

        const promises = imageUrls.map(url => {
          return new Promise((resolve, reject) => {
            const img = new Image();
            img.src = url;
            img.onload = () => {
              bouncingImages.push(img); // L∆∞u tr·ªØ ƒë·ªëi t∆∞·ª£ng Image ƒë√£ t·∫£i
              resolve();
            };
            img.onerror = () => {
              console.error(`Failed to load image: ${url}`);
              reject();
            };
          });
        });

        await Promise.allSettled(promises); // Ch·ªù t·∫•t c·∫£ ·∫£nh ƒë∆∞·ª£c t·∫£i (ho·∫∑c th·∫•t b·∫°i)
        console.log('Ho√†n th√†nh t·∫£i ·∫£nh, s·ªë l∆∞·ª£ng ·∫£nh s·∫µn s√†ng:', bouncingImages.length);
      } catch (error) {
        console.error('Error loading images:', error);
      }
    }

    // New function for fireworks effect
    function startFireworksEffect() {
      if (bouncingImages.length === 0) {
        console.error('No images loaded for fireworks effect.');
        return;
      }
      if (fireworkInterval) {
        clearInterval(fireworkInterval); // Clear any existing interval
      }

      // Kh√¥ng g·ªçi clearFireworks() ·ªü ƒë√¢y n·ªØa ƒë·ªÉ c√°c GIF c≈© c√≥ th·ªÉ ho√†n th√†nh animation
      // clearFireworks();

      fireworkInterval = setInterval(() => {
        const gif = document.createElement('img');
        gif.classList.add('firework-gif');
        const randomIndex = Math.floor(Math.random() * bouncingImages.length);
        gif.src = bouncingImages[randomIndex].src;

        // Random position
        const x = Math.random() * (window.innerWidth - 100); // 100px is approx gif width
        const y = Math.random() * (window.innerHeight - 100);
        gif.style.left = `${x}px`;
        gif.style.top = `${y}px`;

        successScreensaver.appendChild(gif);

        // Remove gif after its animation duration using setTimeout
        const animationDurationMs = 4 * 1000; // 3 seconds from CSS @keyframes fadeAndMove
        setTimeout(() => {
          gif.remove();
        }, animationDurationMs);

      }, 600); // T·∫°o GIF m·ªói 300ms
    }

    // New function to clear all fireworks GIFs (v·∫´n gi·ªØ ƒë·ªÉ d√πng khi c·∫ßn reset ho√†n to√†n)
    function clearFireworks() {
      if (successScreensaver) {
        while (successScreensaver.querySelector('.firework-gif')) {
          successScreensaver.querySelector('.firework-gif').remove();
        }
      }
    }


    // G·ªçi h√†m loadImages khi trang ƒë∆∞·ª£c t·∫£i
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('DOM ƒë√£ ƒë∆∞·ª£c t·∫£i, b·∫Øt ƒë·∫ßu t·∫£i ·∫£nh...');
      await loadImages();
      console.log('Ho√†n th√†nh t·∫£i ·∫£nh');
      // Ban ƒë·∫ßu v√¥ hi·ªáu h√≥a n√∫t submit n·∫øu input r·ªóng
      if (answerInput.value.trim() === '') {
        submitBtn.disabled = true;
      }
    });

    let currentImgIndex = 0;

    function showScreensaver(songUrl) {
      if (bouncingImages.length === 0) {
        console.error('No images loaded');
        return;
      }
      const screensaver = document.getElementById("screensaver");
      const bouncingImg = document.getElementById("bouncing-image");
      const audio = document.getElementById("myAudio");
      const source = document.getElementById("audio-source");

      if (animationInterval) {
        clearInterval(animationInterval);
      }

      screensaver.style.display = "flex";

      const randomIndex = Math.floor(Math.random() * bouncingImages.length);
      currentImgIndex = randomIndex;

      // Lo·∫°i b·ªè c√°c d√≤ng ·∫©n/hi·ªán ·∫£nh
      // bouncingImg.style.visibility = 'hidden';
      bouncingImg.src = bouncingImages[randomIndex].src;
      // setTimeout(() => {
      //     bouncingImg.style.visibility = 'visible';
      // }, 0);


      // X·ª≠ l√Ω audio an to√†n h∆°n
      try {
        audio.pause();
        audio.currentTime = 0;

        source.src = songUrl;
        audio.load();

        // Th√™m m·ªôt ch√∫t delay tr∆∞·ªõc khi play
        setTimeout(() => {
          audio.play().catch(error => {
            if (error.name !== 'AbortError') {
              console.log('Audio play error:', error);
            }
          });
        }, 100);
      } catch (error) {
        console.log('Audio handling error:', error);
      }

      screensaver.style.display = "block";

      let dx = 3;
      let dy = 2;
      let x = 100;
      let y = 100;

      animationInterval = setInterval(() => {
        const imgWidth = bouncingImg.clientWidth;
        const imgHeight = bouncingImg.clientHeight;
        const maxX = window.innerWidth - imgWidth;
        const maxY = window.innerHeight - imgHeight;

        x += dx;
        y += dy;

        if (x <= 0 || x >= maxX) {
          dx *= -1;
          switchImageRandom();
        }

        if (y <= 0 || y >= maxY) {
          dy *= -1;
          switchImageRandom();
        }

        bouncingImg.style.left = `${x}px`;
        bouncingImg.style.top = `${y}px`;
      }, 16);

      audio.onended = function() {
        screensaver.style.display = "none";
        if (animationInterval) {
          clearInterval(animationInterval);
          animationInterval = null;
        }
      };
    }

    function switchImageRandom() {
      const bouncingImg = document.getElementById("bouncing-image");
      if (!bouncingImg) return;

      let newIndex;
      do {
        newIndex = Math.floor(Math.random() * bouncingImages.length);
      } while (newIndex === currentImgIndex && bouncingImages.length > 1);

      currentImgIndex = newIndex;
      // Lo·∫°i b·ªè c√°c d√≤ng ·∫©n/hi·ªán ·∫£nh
      // bouncingImg.style.visibility = 'hidden';
      bouncingImg.src = bouncingImages[currentImgIndex].src;
      // setTimeout(() => {
      //     bouncingImg.style.visibility = 'visible';
      // }, 0);
    }

    document.addEventListener('keydown', function handleAnyKeyExitScreensaver(e) {
      const screensaver = document.getElementById("screensaver");
      if (screensaver && screensaver.style.display === "block") {
        screensaver.style.display = "none";
        if (animationInterval) {
          clearInterval(animationInterval);
          animationInterval = null;
        }

        const audio = document.getElementById('myAudio');
        if (audio) {
          audio.pause();
          audio.currentTime = 0;
        }
      }
    });

    // X·ª≠ l√Ω khi tab ·∫©n/hi·ªán ƒë·ªÉ d·ª´ng/kh·ªüi ƒë·ªông l·∫°i vi·ªác t·∫°o GIF ph√°o hoa
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        // Tab b·ªã ·∫©n, d·ª´ng vi·ªác t·∫°o GIF ph√°o hoa m·ªõi
        if (fireworkInterval) {
          clearInterval(fireworkInterval);
          fireworkInterval = null;
        }
      } else {
        // Tab hi·ªÉn th·ªã tr·ªü l·∫°i, ti·∫øp t·ª•c t·∫°o GIF m·ªõi n·∫øu m√†n h√¨nh th√†nh c√¥ng ƒëang hi·ªÉn th·ªã
        if (successScreensaver && successScreensaver.style.display === 'block') {
          startFireworksEffect(); // S·∫Ω ti·∫øp t·ª•c t·∫°o GIF m·ªõi, c√°c GIF c≈© s·∫Ω t·ª± bi·∫øn m·∫•t theo setTimeout
        }
      }
    });

  </script>
  <div id="screensaver">
    <div id="exit-hint">Press any key to exit (tr·ª´ n√∫t Space)</div>
    <img id="bouncing-image" src="" alt="Bouncing" />
  </div>



</body>

</html>